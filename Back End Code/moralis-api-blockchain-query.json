<script runat="server">
  Platform.Load("core", "1.1.5");
  
  try {
  
  // capture wallet that is being passed in from the form
  var wallet = Platform.Request.GetFormField('wallet');

  // Token Symbol to search for
  var tokenSymbol = 'CTAA';
  
  // hardcode wallet for testing
  // var wallet = 'WALLET-ADDRESS';
    
  var accessToken = 'YOUR-API-KEY';
    
  var url = 'https://deep-index.moralis.io/api/v2/0xAe6afb0ad93b44a8e289AFBB77B403abd2F95802/nft?chain=eth&format=decimal'
  
  var req = new Script.Util.HttpRequest(url);
      req.emptyContentHandling = 0;
      req.retries = 2;
      req.continueOnError = true;
      req.contentType = "application/json"
      req.setHeader("X-API-Key", accessToken);
      req.method = "GET"; 

      var resp = req.send();

      var resultJSON = Platform.Function.ParseJSON(String(resp.content));

      var result = resultJSON.result;
     
      var ctaa = false;
    
      for (i = 0; i < result.length; i++) {
        
        var symbol = result[i].symbol;
        
        if (symbol === tokenSymbol) {
            var ctaa = true;
          
            var metadataJSON = Platform.Function.ParseJSON(String(result[i].metadata));
                    
            var imageURL = Stringify(metadataJSON.image_url);
          
          }
      }
   
    
  var response = {
      "ok": true,
      "message": imageURL.replace(/['"]+/g, '')
    }
  Write(Stringify(response));
    }
  
  catch (e) {
   Write("<br>" + Stringify(e))
  }
  
</script>